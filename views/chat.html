<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>채팅창</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* 스타일은 필요에 따라 설정 */
    </style>
</head>
<body>
<div id="chat-box">
    <span>${recipient}님과의 채팅</span><br>
    <hr>
    <ul id="messages"></ul>
</div>

<div>
    <input type="hidden" id="recipient" readonly>
    <br><br><textarea id="message" placeholder="메세지를 입력하세요."></textarea>
    <button onclick="sendMessage()">보내기</button>
</div>

<script>
    var socket = io();  // Socket.IO 클라이언트 생성

    // 서버에서 메시지를 받으면 화면에 표시
    socket.on('chat message', function(message) {
        showMessage(message);
    });

    // 메시지 전송
    function sendMessage() {
        var sender = document.getElementById("sender").value;
        var recipient = document.getElementById("recipient").value;
        var message = document.getElementById("message").value;

        var chatMessage = {
            sender: sender,
            recipient: recipient,
            content: message
        };

        socket.emit('chat message', chatMessage);  // 메시지를 서버로 전송
        document.getElementById("message").value = ''; // 메시지 전송 후 입력란 비우기
    }

    // 메시지 화면에 표시
    function showMessage(message) {
        var messageElement = document.createElement('li');
        messageElement.appendChild(document.createTextNode(message.sender + ": " + message.content));
        document.getElementById("messages").appendChild(messageElement);
    }

    // URL에서 쿼리 파라미터 추출
    const urlParams = new URLSearchParams(window.location.search);
    const recipient = urlParams.get('username'); // 'username' 키의 값 가져오기

    // 디버깅용 로그 출력
    console.log('Recipient:', recipient);

    if (recipient) {
        // recipient 입력란에 username 값 설정
        document.getElementById('recipient').value = recipient;

        // HTML 요소에 동적으로 사용자 이름 표시
        document.body.insertAdjacentHTML('afterbegin', `<h1>${recipient}</h1>`);
    } else {
        console.log('Recipient 파라미터가 없습니다!');
        document.body.insertAdjacentHTML('afterbegin', `<h1>Recipient 파라미터가 없습니다!</h1>`);
    }
</script>

</body>
</html>
